<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../Layouts/Head.ejs') %>
</head>

<body class="<%= darkMode %>">
  <%- include('../Layouts/SideBar.ejs') %>
  <div id="main">
    <%- include('../Layouts/NavBar.ejs') %>
    <div class="main-content container-fluid">
      <div class="row justify-content-center">


        <div class="col-lg-10 col-md-12 col-12">
          <h2 class="text-center">Saldos a Favor</h2>

          <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered tabl-sm" id="dataTable">
              <thead>
                <tr>
                  <th>Nombre del Cliente</th>
                  <th>Saldos a favor</th>
                  <th>Ventas Pendientes</th>
            </tr>
              </thead>
              <tbody>
                <% clients.forEach(cli => { 
                  let sls = sales[cli.id] || [];
                  let pms = payments[cli.id] || [];
                  
                  %>
                <tr>
                  <td>
                        <a target="_blank" href="/sales/client/view/<%= cli.id %>"><%= cli.name %></a>
                  </td>
                  <td>
                        <% if (pms.length > 0) { %>
                        <ul>
                          <% pms.forEach(pm => { %>
                          <li class="mt-2">
                         (Pago id: <%= pm.id %>)<br>
                         Monto:  $<%= Helper.money_format(pm.amount) %>
                         <br>
                          Saldo a favor: $<%= Helper.money_format((pm.amount - pm.asigned_amount).toFixed(2)) %>
                          </li>
                          <% }) %>
                         
                        <% } %>
                  </td>
                  <td>
                        <% if (sls.length > 0) { %>
                        <ul>
                          <% sls.forEach(sale => { 
                            let amount = (sale.delivery_amount || 0) + sale.balance;
                            %>
                          <li class="mt-2">
                            <a target="_blank" href="/sales/view/<%= sale.id %>">Venta #<%= sale.id %>
                              <br>
                              Monto Vendido: $<%= Helper.money_format(amount) %>
                              <br>
                              Monto Cobrado: $<%= Helper.money_format(sale.collected) %>
                              <br>
                              Saldo Pendiente: $<%= Helper.money_format(amount - sale.collected) %>
                            </a>
                          </a>
                          </li>
                          <% }) %>
                        </ul>
                         
                        <% } %>
                  </td>

                  
                </tr>


                <% }) %>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
    <%- include('../Layouts/Footer.ejs') %>
  </div>
</body>
<%- include('../Layouts/Scripts.ejs') %>


</html>
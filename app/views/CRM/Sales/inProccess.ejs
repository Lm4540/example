<!DOCTYPE html>
<html lang="en">

<head>
   <%- include('../../Layouts/Head.ejs') %>
   <link rel="stylesheet" href="assets/libs/grid/mermaid.css">
   <link rel="stylesheet" href="assets/libs/choices/choices.min.css">
   <style>

   </style>
</head>

<body class="<%= darkMode %>">
   <%- include('../../Layouts/SideBar.ejs') %>
   <div id="main">
      <%- include('../../Layouts/NavBar.ejs') %>
      <div class="main-content container-fluid">
         <h3 class="text-center mb-4">Ventas en Proceso</h3>

         <div class="row mt-4 mb-5">
            <div class="col">
               <div class="form-group">
                  <label for="status">Status</label>
                  <select name="status_select" id="status_select" class="form-control">
                     <option value="all">Todos</option>
                  </select>
               </div>
            </div>
            <div class="col">
               <div class="form-group">
                  <label for="seller_select">Status</label>
                  <select name="seller_select" id="seller_select" class="form-control">
                     <option value="all">Todos</option>
                     <% employees.forEach(el => { %>
                      <option value="<%= el.id %>"><%= el.name %></option>
                     <% }) %>
                  </select>
               </div>
            </div>
            <div class="col">
               <button class="btn round btn-warning mt-4" onclick="filtrar()">Filtrar</button>
            </div>
         </div>


         <div class="table-responsive">
            <table class="table table-sm table-hover table-bordered">
               <thead>
                  <tr>
                     <th>Cliente</th>
                     <th>Fecha de Apertura</th>
                     <th>Monto</th>
                     <th>Vendedor</th>
                     <th>Estado</th>
                     <th>opt</th>
                  </tr>
               </thead>
               <tbody>
                  <% sales.forEach(sale => { %>
                  <tr class="text-center">
                     <td>
                        <%= clients[sale.client] %>
                     </td>
                     <td>
                        <% if (limit_date > sale.createdAt) { %>
                        <span class="text-danger">
                           <%= Helper.date_to_spanish(sale.createdAt) %>

                        </span>
                        <% } else { %>
                        <%= Helper.date_to_spanish(sale.createdAt) %>

                        <% } %>
                     </td>
                     <td>$<%= Helper.money_format(sale.balance) %></td>
                     <td><%= sellers[sale.seller] %></td>
                     <td>
                        <%= status[sale._status] %>
                     </td>
                     <td>
                        <a href="/sales/view/<%= sale.id %>" class="badge bg-red">Ver</a>
                     </td>
                  </tr>
                  <% }) %>
               </tbody>
            </table>
         </div>

      </div>
      <%- include('../../Layouts/Footer.ejs') %>
   </div>
</body>
<%- include('../../Layouts/Scripts.ejs') %>
<script>

   const filtrar = () => {
      let seller = document.querySelector("#seller_select").value;
      let status = document.querySelector("#status_select").value;
      window.location.href= `/sales/inProccess?_status=${status}&seller=${seller}`;
   }
</script>

</html>